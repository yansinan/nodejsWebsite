{% extends "../public/footer.html" %} 
{% block footerUp %}
    <div class="timelineContainer border-top border-dark">
        <div class="timelineLeft timelineLeft-md">

        </div>
        <div class="timelineMain">
            <div id="scrollbarTimeLine" class="d-none" style="overflow:visible;height:0px;">
                <div class="border-4 border-start border-dark" style="width:10px;height:105px;background-color:#52FF00;opacity: 1;"></div>
            </div>

            <div id="bsTimelineBarWrapper" class="timelineBar d-flex"> 
                <div class="bsTimelineBarContent">           
                {# {{timelineBar(objTimeline)}} #}
                {{timelineBarDocs(objTimeline,true)}}
                </div>
            </div>
        </div>
        {# 年份 #}
        <div id="timelineYearContainer" class="timelineYearContainer">
            {% for year in objTimeline.listIdxYears %}  
            <div class="timelineYear"><span>{{year.strTitle}}</span></div>
            {% endfor %}
        </div>
    </div>
    <script>
        {# 时间轴上拉动画 #}
        Object.defineProperties(this,{
            $footer:{
                get:()=>{this._$footer = this._$footer || document.getElementById("dr-footer");return this._$footer;},
            }
        })
        this.$footer.$svgTimelineBar=document.getElementById("svgTimelineBar");
        {# 判断是否经过旋转 #}
        this.$footer.isRotated=function(){
            function getTranslate(node,sty){//获取transform值
                var translates=document.defaultView.getComputedStyle(node,null).transform.substring(7);
                var result = translates.match(/\(([^)]*)\)/);// 正则()内容
                var matrix=result?result[1].split(','):translates.split(',');
                if(sty=="x" || sty==undefined){
                    return matrix.length>6?parseFloat(matrix[12]):parseFloat(matrix[4]);
                }else if(sty=="y"){
                    return matrix.length>6?parseFloat(matrix[13]):parseFloat(matrix[5]);
                }else if(sty=="z"){
                    return matrix.length>6?parseFloat(matrix[14]):0;
                }else if(sty=="rotate"){
                    return matrix.length>6?getRotate([parseFloat(matrix[0]),parseFloat(matrix[1]),parseFloat(matrix[4]),parseFloat(matrix[5])]):getRotate(matrix);
                }
            }
            function getRotate(matrix){
                var aa=Math.round(180*Math.asin(matrix[0])/ Math.PI);
                var bb=Math.round(180*Math.acos(matrix[1])/ Math.PI);
                var cc=Math.round(180*Math.asin(matrix[2])/ Math.PI);
                var dd=Math.round(180*Math.acos(matrix[3])/ Math.PI);
                var deg=0;
                if(aa==bb||-aa==bb){
                    deg=dd;
                }else if(-aa+bb==180){
                    deg=180+cc;
                }else if(aa+bb==180){
                    deg=360-cc||360-dd;
                }
                return deg>=360?0:deg;
            
            }
            if(getTranslate(this,"rotate")==90)return true;
            return false;
        }

        // 添加一个适当的事件监听器
        this.addEventListener("BS_COVER_WILL_LISTARTISTS", (page)=>{
            document.documentElement.style.setProperty('--footer-size-mobile', "16px");
            document.documentElement.style.setProperty('--footer-size-pc', "16px");
            $footer.classList.add("listArtist");
            $footer.classList.remove("done");
        })
        this.addEventListener("BS_COVER_WILL_TIMELINE", (page)=>{
            document.documentElement.style.setProperty('--footer-size-mobile', "54px");
            document.documentElement.style.setProperty('--footer-size-pc', "106px");
            $footer.classList.add("timeline");
            $footer.classList.remove("done");
        })
        this.addEventListener("BS_COVER_TIMELINE", (page)=>{
            $footer.classList.add("timeline","done");
            $footer.classList.remove("listArtist");
        })
        this.addEventListener("BS_COVER_LISTARTISTS", (page)=>{
            $footer.classList.add("listArtist","done");
            $footer.classList.remove("timeline");
        })
    </script>
    {% include "../js/timelineBar.html" %}
{% endblock%}
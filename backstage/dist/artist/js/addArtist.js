(window.webpackJsonp=window.webpackJsonp||[]).push([["addArtist"],{4972:function(t,e,a){"use strict";a.r(e);a("a96f"),a("ed83"),a("d5d3"),a("80bd");var s=a("c968"),r=(a("547e"),a("f99b"),a("c39e"),a("fb5e"),a("5424")),o=a("2030"),i=a.n(o),l=(a("330f"),a("512b")),n=a("3d34"),m=(a("5567"),{name:"",url:"",icon:""}),c={props:{title:{type:String,default:"名称"},label:String,listObjURL:{type:Array,default:function(){return[Object.assign({},m)]}}},data:function(){var t=this;return{modalURL:{listObjURL:this.listObjURL},res:{listObjURL:function(){return 0<t.listObjURL.length&&t.listObjURL[t.listObjURL.length-1]&&""==t.listObjURL[t.listObjURL.length-1].url&&t.listObjURL.pop(),!(!t.listObjURL.length||0==t.listObjURL.length)&&t.listObjURL}}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;e.res.listObjURL&&e.$emit("list-changed",e.res.listObjURL)})},resetForm:function(t){this.$refs[t].resetFields(),this.res.listObjURL&&this.$emit("list-changed",this.res.listObjURL)},removeDomain:function(a){var t=this.modalURL.listObjURL.findIndex(function(t,e){return t.url==a.url});-1!==t&&this.modalURL.listObjURL.splice(t,1),this.res.listObjURL&&this.$emit("list-changed",this.res.listObjURL)},addDomain:function(){this.modalURL.listObjURL.push(Object.assign({},m)),this.res.listObjURL&&this.$emit("list-changed",this.res.listObjURL)}}},d=a("19c7"),u=Object(d.a)(c,function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("el-form",{ref:"dynamicListForm",staticClass:"demo-dynamic",attrs:{inline:!0,model:a.modalURL,"label-width":"100px"}},[a._l(a.modalURL.listObjURL,function(e,t){return s("el-form-item",{key:e.key,attrs:{label:t+".",prop:"listObjURL["+t+"]",rules:{required:!0,message:a.label+"不能为空",trigger:"blur"}}},[s("el-col",{attrs:{span:8}},[s("el-input",{model:{value:e.name,callback:function(t){a.$set(e,"name",t)},expression:"domain.name"}},[s("template",{slot:"prefix"},[a._v(a._s(a.label+": "))])],2)],1),s("el-col",{attrs:{span:16}},[s("el-input",{model:{value:e.url,callback:function(t){a.$set(e,"url",t)},expression:"domain.url"}},[s("template",{slot:"prepend"},[a._v("Http://")]),s("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(t){return t.preventDefault(),a.removeDomain(e)}},slot:"append"})],2)],1)],1)}),s("el-button",{on:{click:a.addDomain}},[a._v("增加")])],2)},[],!1,null,null,null).exports,f=a("60bb"),p=a.n(f),g=a("5880");function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,s)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach(function(t){Object(r.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var v="artist",S=Object(g.createNamespacedHelpers)(v),$={props:{groups:Array},data:function(){var s=this;return{contentState:[{value:"0",label:"退回"},{value:"1",label:"待审核"},{value:"2",label:"审核通过"},{value:"3",label:"审核不通过"}],selectUserList:[],loading:!1,userLoading:!1,loadingTag:!1,selectSpecialList:[],content:"",simpleComments:"",isflash:!1,config:{initialFrameWidth:null,initialFrameHeight:320},imageUrl:"",currentType:"1",rules:{sImg:[{required:!0,message:this.$t("validate.selectNull",{label:"缩略图"}),trigger:"blur"}],name:[{required:!0,message:this.$t("validate.inputNull",{label:this.$t("contents.name")}),trigger:"blur"},{min:1,max:50,message:this.$t("validate.rangelength",{min:1,max:50}),trigger:"blur"}],tags:[{validator:function(t,e,a){p.a.isEmpty(e)?a(new Error(s.$t("validate.selectNull",{label:s.$t("contents.tags")}))):a()},trigger:"change"}],discription:[{required:!0,message:this.$t("validate.inputNull",{label:this.$t("contents.discription")}),trigger:"blur"},{min:5,max:300,message:this.$t("validate.rangelength",{min:5,max:100}),trigger:"blur"}],comments:[{required:!0,message:this.$t("validate.inputNull",{label:this.$t("contents.comments")}),trigger:"blur"},{min:5,message:this.$t("validate.rangelength",{min:5,max:1e5}),trigger:"blur"}]}}},components:{VueUeditorWrap:i.a,ListURL:u},methods:b({},S.mapActions(["showContentForm"]),{changeTargetUser:function(){var i=this,n=this;this.formState.formData.listMembers.forEach(function(e,a,t){var s=i.dataMembers.docs.find(function(t){return t._id==e}),r=!!s;if(r)i.updateKeywords(s.name);else{n.userLoading=!0;var o={name:e,comments:"即时创建",group:"乐手"};Object(l.b)(o).then(function(t){200===t.data.status?(n.$message({message:n.$t("main.addSuccess"),type:"success"}),n.formState.formData.listMembers[a]=t.data.data._id,n.updateKeywords(e),n.userLoading=!0,n.remoteUserMethod()):n.$message.error(t.data.message),n.loadingTag=!1})}})},eChangeTags:function(){var o=this;this.formState.formData.tags.forEach(function(e,a,t){var s=o.contentTagList.docs.find(function(t){return t._id==e});if(!!s)o.updateKeywords(s.name);else{o.loadingTag=!0;var r={name:e,comments:"即时创建",alias:e};Object(n.a)(r).then(function(t){200===t.data.status?(o.$store.dispatch("contentTag/getContentTagList"),o.$message({message:o.$t("main.addSuccess"),type:"success"}),o.formState.formData.tags[a]=t.data.data._id,o.updateKeywords(e)):o.$message.error(t.data.message),o.loadingTag=!1})}})},remoteUserMethod:function(t){var e=0<arguments.length&&void 0!==t?t:"";if(""!==e){this.userLoading=!0;this.queryUserListByParams({searchkey:e,pageSize:200})}else this.queryUserListByParams({pageSize:200})},queryUserListByParams:function(t){var e=0<arguments.length&&void 0!==t?t:{};Object.assign(e,{pageSize:200}),this.$store.dispatch("artist/getArtistList",e),this.userLoading=!1},getRandomContentImg:function(t){var o=this,e=0<arguments.length&&void 0!==t?t:{};Object(l.e)(e).then(function(t){if(200==t.status&&t.data&&t.data.data){var e=t.data.data[0],a=Object.assign({},o.formState.formData,{sImg:e}),s=localStorage.getItem("contentAuthor");if(s){var r=JSON.parse(s);o.queryUserListByParams({searchkey:r.label}),Object.assign(a,{targetUser:r.value})}o.showContentForm({formData:a})}}).catch(function(t){})},checkFlashPost:function(t){this.showContentForm({edit:this.formState.edit,formData:Object.assign({},this.formState.formData,{type:t?"2":"1"})})},inputEditor:function(t){this.showContentForm({edit:this.formState.edit,formData:Object.assign({},this.formState.formData,{markDownComments:t})})},changeEditor:function(){},getLocalContents:function(){var t=localStorage.getItem("addContent")||"";return t?JSON.parse(t):{}},editorReady:function(t){var e=this;this.ueditorObj=t,this.formState.edit?setTimeout(function(){t.setContent(e.formState.formData.comments),e.simpleComments=t.getPlainTxt()},1500):t.setContent(""),t.addListener("contentChange",function(){e.content=t.getContent(),e.simpleComments=t.getPlainTxt(),e.showContentForm({edit:e.formState.edit,formData:Object.assign({},e.formState.formData,{comments:e.content,simpleComments:e.simpleComments})})})},handleAvatarSuccess:function(t){var e=t.data.path;this.showContentForm({edit:this.formState.edit,formData:Object.assign({},this.formState.formData,{sImg:e})})},beforeAvatarUpload:function(t){var e="image/jpeg"===t.type,a="image/png"===t.type,s="image/gif"===t.type,r=t.size/1024/1024<2;return e||a||s||this.$message.error(this.$t("validate.limitUploadImgType")),r||this.$message.error(this.$t("validate.limitUploadImgSize",{size:2})),(e||a||s)&&r},backToList:function(){this.$router.push("/"+v)},eListHotMusicChanged:function(){},eListLinks:function(){},eChangeDate:function(){},updateKeywords:function(t){var e=this.formState.formData.keywords.split(",");return t&&""!=t&&e.push(t),e=Object(s.a)(new Set(e)),this.formState.formData.keywords=e.join(),this.formState.formData.keywords},submitForm:function(t,e){var a=this;this.$refs[t].validate(function(t){if(!t)return!1;var e=Object.assign({},a.formState.formData,{comments:a.ueditorObj.getContent(),simpleComments:a.ueditorObj.getPlainTxt()});a.formState.edit?Object(l.i)(e).then(function(t){200===t.data.status?(a.$router.push("/"+v),a.$message({message:a.$t("main.updateSuccess"),type:"success"})):a.$message.error(t.data.message)}):Object(l.a)(e).then(function(t){200===t.data.status?(a.$router.push("/"+v),a.$message({message:a.$t("main.addSuccess"),type:"success"})):a.$message.error(t.data.message)})})}}),computed:b({},Object(g.mapGetters)(["contentTagList","contentCategoryList"]),{},S.mapState({formState:function(t){return t.formState},dataMembers:function(t){return t.dataMembers}})),mounted:function(){var o=this,e=this;if(this.$route.params.id)Object(l.d)({id:this.$route.params.id}).then(function(t){if(200===t.data.status)if(t.data.data){var e=t.data.data,a=[],s=[];if(e.categories&&(e.categories.map(function(t,e){t&&a.push(t._id)}),e.categories=a),e.tags&&(e.tags.map(function(t,e){t&&s.push(t._id)}),e.tags=s),e.keywords&&(e.keywords=e.keywords.join()),e.listMembers){var r=e.listMembers.map(function(t){return t._id});o.remoteUserMethod(),e.listMembers=r}o.showContentForm({edit:!0,formData:e})}else o.$message({message:o.$t("validate.error_params"),type:"warning",onClose:function(){o.$router.push("/"+v)}});else o.$message.error(t.data.message)});else{var a=this.getLocalContents();p.a.isEmpty(a)?this.getRandomContentImg():this.$confirm(this.$t("main.askForReInputContent"),this.$t("main.scr_modal_title"),{confirmButtonText:this.$t("main.confirmBtnText"),cancelButtonText:this.$t("main.cancelBtnText"),type:"warning"}).then(function(){var t=a.comments||"";e.$refs.ueditor.setContent(t),localStorage.removeItem(o.$route.path.split("/")[1]),o.showContentForm({edit:!1,formData:a})}).catch(function(){localStorage.removeItem(o.$route.path.split("/")[1]),o.$message({type:"info",message:o.$t("main.scr_modal_del_error_info")})})}this.$store.dispatch("contentCategory/getContentCategoryList"),this.$store.dispatch("contentTag/getContentTagList",{pageSize:200}),this.$store.dispatch("artist/getArtistList",{pageSize:200})}},D=(a("6ea2"),Object(d.a)($,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dr-contentForm"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.formState.formData,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:e.$t("contents.enable"),prop:"state"}},[a("el-select",{attrs:{size:"small",placeholder:"审核文章"},model:{value:e.formState.formData.state,callback:function(t){e.$set(e.formState.formData,"state",t)},expression:"formState.formData.state"}},e._l(e.contentState,function(t){return a("el-option",{key:"kw_"+t.value,attrs:{label:t.label,value:t.value}})}),1)],1),"3"==e.formState.formData.state?a("el-form-item",{attrs:{label:"驳回原因",prop:"dismissReason"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.dismissReason,callback:function(t){e.$set(e.formState.formData,"dismissReason",t)},expression:"formState.formData.dismissReason"}})],1):e._e(),a("el-form-item",{attrs:{label:e.$t("artist.name"),prop:"name"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.name,callback:function(t){e.$set(e.formState.formData,"name",t)},expression:"formState.formData.name"}})],1),a("el-form-item",{attrs:{label:e.$t("artist.nameAlias"),prop:"alias"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.alias,callback:function(t){e.$set(e.formState.formData,"alias",t)},expression:"formState.formData.alias"}})],1),a("el-form-item",{attrs:{label:e.$t("artist.from"),prop:"from"}},[a("el-input",{attrs:{size:"small",placeholder:"中国/China"},model:{value:e.formState.formData.from,callback:function(t){e.$set(e.formState.formData,"from",t)},expression:"formState.formData.from"}})],1),a("el-form-item",{attrs:{label:e.$t("artist.date"),prop:"listDateDur"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"加入日期"},on:{change:e.eChangeDate},model:{value:e.formState.formData.listDateDur[0],callback:function(t){e.$set(e.formState.formData.listDateDur,0,t)},expression:"formState.formData.listDateDur[0]"}}),a("el-date-picker",{attrs:{type:"date",placeholder:"退出日期"},on:{change:e.eChangeDate},model:{value:e.formState.formData.listDateDur[1],callback:function(t){e.$set(e.formState.formData.listDateDur,1,t)},expression:"formState.formData.listDateDur[1]"}})],1),a("el-form-item",{attrs:{label:e.$t("artist.listMembers"),prop:"listMembers"}},[a("el-select",{attrs:{size:"medium",filterable:"",multiple:"","allow-create":"",placeholder:"请输入乐队成员名","remote-method":e.remoteUserMethod,loading:e.userLoading},on:{change:e.changeTargetUser},model:{value:e.formState.formData.listMembers,callback:function(t){e.$set(e.formState.formData,"listMembers",t)},expression:"formState.formData.listMembers"}},e._l(e.dataMembers.docs,function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})}),1)],1),"1"==e.formState.formData.type?a("div",[a("el-form-item",{attrs:{label:"乐队关键字",prop:"keywords"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.keywords,callback:function(t){e.$set(e.formState.formData,"keywords",t)},expression:"formState.formData.keywords"}})],1),a("el-form-item",{attrs:{label:"乐队标签",prop:"tags"}},[a("el-select",{attrs:{size:"medium",multiple:"",filterable:"","allow-create":"",loading:e.userLoading,placeholder:e.$t("validate.selectNull",{label:this.$t("contents.tags")})},on:{change:e.eChangeTags},model:{value:e.formState.formData.tags,callback:function(t){e.$set(e.formState.formData,"tags",t)},expression:"formState.formData.tags"}},e._l(e.contentTagList.docs,function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})}),1)],1)],1):e._e(),a("el-form-item",{staticClass:"upSimg",attrs:{label:e.$t("contents.sImg"),prop:"sImg"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/v0/upload/files?type=images","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.formState.formData.sImg?a("img",{staticClass:"avatar",attrs:{src:e.formState.formData.sImg}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("el-button",{staticClass:"refresh-btn",attrs:{size:"mini",plain:"",round:""},on:{click:function(t){return e.getRandomContentImg()}}},[a("i",{staticClass:"fa fa-refresh"})])],1),a("el-form-item",{attrs:{label:e.$t("contents.discription"),prop:"discription"}},[a("el-input",{attrs:{size:"small",type:"textarea"},model:{value:e.formState.formData.discription,callback:function(t){e.$set(e.formState.formData,"discription",t)},expression:"formState.formData.discription"}})],1),a("el-form-item",{attrs:{label:e.$t("contents.comments"),prop:"comments"}},[a("vue-ueditor-wrap",{staticClass:"editorForm",attrs:{config:e.editorConfig},on:{ready:e.editorReady},model:{value:e.formState.formData.comments,callback:function(t){e.$set(e.formState.formData,"comments",t)},expression:"formState.formData.comments"}})],1),a("el-form-item",{attrs:{label:e.$t("artist.listHotMusics"),prop:"listHotMusics"}},[a("ListURL",{ref:"listHotMusics",attrs:{label:"歌名"},on:{"list-changed":e.eListHotMusicChanged}})],1),a("el-form-item",{attrs:{label:e.$t("artist.listLinks"),prop:"listLinks"}},[a("ListURL",{ref:"listLinks",attrs:{label:"注释"},on:{"list-changed":e.eListLinks}})],1),a("el-form-item",{staticClass:"dr-submitContent"},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(e._s(e.formState.edit?e.$t("main.form_btnText_update"):e.$t("main.form_btnText_save")))]),a("el-button",{attrs:{size:"medium"},on:{click:e.backToList}},[e._v(e._s(e.$t("main.back")))])],1)],1)],1)},[],!1,null,null,null));e.default=D.exports},"6ea2":function(t,e,a){"use strict";var s=a("9860");a.n(s).a},9860:function(t,e,a){var s=a("c950");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,a("9c02").default)("38d0e8ac",s,!0,{sourceMap:!1,shadowMode:!1})},c950:function(t,e,a){(t.exports=a("6c7a")(!1)).push([t.i,".dr-contentForm{margin:15px 0;width:80%;padding-bottom:50px}.dr-contentForm .post-rate .el-rate{margin-top:10px}.dr-contentForm .dr-submitContent{position:fixed;z-index:9999999;padding:10px 30px;text-align:right;right:0;bottom:0;background:none;margin-bottom:0}.dr-contentForm .avatar-uploader .el-upload{border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.dr-contentForm .avatar-uploader .el-upload:hover{border-color:#409eff}.dr-contentForm .avatar-uploader-icon{font-size:28px;color:#8c939d;width:200px;height:150px;line-height:150px;text-align:center}.dr-contentForm .avatar{width:200px;height:158px;display:block}.dr-contentForm .upSimg{position:relative}.dr-contentForm .upSimg .refresh-btn{position:absolute;left:220px;top:0}.dr-contentForm .upSimg .refresh-btn i{font-weight:400}",""])}}]);
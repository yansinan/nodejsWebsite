(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2cf836f4"],{"04e6":function(t,e,a){(t.exports=a("690e")(!1)).push([t.i,".dr-contentForm{margin:15px 0;width:80%;padding-bottom:50px}.dr-contentForm .post-rate .el-rate{margin-top:10px}.dr-contentForm .dr-submitContent{position:fixed;z-index:9999999;padding:10px 30px;text-align:right;right:0;bottom:0;background:none;margin-bottom:0}.dr-contentForm .avatar-uploader .el-upload{border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden}.dr-contentForm .avatar-uploader .el-upload:hover{border-color:#409eff}.dr-contentForm .avatar-uploader-icon{font-size:28px;color:#8c939d;width:200px;height:150px;line-height:150px;text-align:center}.dr-contentForm .avatar{width:200px;height:158px;display:block}.dr-contentForm .upSimg{position:relative}.dr-contentForm .upSimg .refresh-btn{position:absolute;left:220px;top:0}.dr-contentForm .upSimg .refresh-btn i{font-weight:400}",""])},1179:function(t,e,a){"use strict";a("53f5")},1953:function(t,e,a){"use strict";a.r(e);a("ac67"),a("32ea"),a("fc02"),a("a450"),a("0c84"),a("c5cb");var i=a("0e2e"),r=(a("e5b4"),a("1bc7"),a("34f5")),o=(a("6e69"),a("196d")),s=a.n(o),n=a("330f"),l=a("79b1"),m=a("3d34"),c=(a("a7e5"),{name:"",url:"",icon:"",error:""}),d={props:{label:{type:String,default:"链接"},listObjURL:{type:Array,default:function(){return[Object.assign({},c)]}}},data:function(){return{objToAdd:Object.assign({},c),strErrorAdd:"",strErrorUpdate:""}},methods:{removeDomain:function(a){var t=this.listObjURL.findIndex(function(t,e){return t.url==a.url});-1!==t&&this.listObjURL.splice(t,1),this.listObjURL&&this.$emit("list-changed",this.listObjURL)},getURLData:function(e,a){var t,r=this;return-1!=e.url.indexOf("weibo.com")&&(e.icon="/static/themes/images/link/logo_sina_32x32.png"),-1!=e.url.indexOf("douban.com")&&(e.icon="/static/themes/images/link/logo_douban_32x32.png"),-1!=e.url.indexOf("music.163.com")&&(e.icon="/static/themes/images/link/logo_163_32x32.png"),-1!=e.url.indexOf("weibo.com")&&(e.name="微博"),-1!=e.url.indexOf("douban.com")&&(e.name="豆瓣小站"),-1!=e.url.indexOf("music.163.com")&&(e.name="网易云音乐",-1!=e.url.indexOf("song?id=")&&(e.type="音乐",e.name="歌曲名",t=e.url.split("song?id=")[1],fetch("https://api.imjad.cn/cloudmusic/?type=detail&id="+t).then(function(t){return t.text()}).then(function(t){t=JSON.parse(t);200==t.code&&0<t.songs.length&&t.songs[0].name?(e.name=t.songs[0].name,r.$message({message:"找到网易云音乐歌曲信息，自动填充："+e.name,type:"success"}),this.listObjURL&&this.$emit("list-changed",this.listObjURL)):(e.name="歌曲无效",r.$message.error(r.$t("validate.inputCorrect",{label:"网易云音乐获取歌曲名称"})),"formUpdate"==a&&(r.strErrorUpdate="未找到网易云音乐歌曲信息："+e.url),"formAdd"==a&&(r.strErrorAdd="未找到网易云音乐歌曲信息："+e.url))}))),e},eChangeURL:function(t){t.index;t=t.objLink;this.getURLData(t,"formUpdate")},eAddURL:function(t){var e=this;this.objToAdd.url=t,this.getURLData(this.objToAdd,"formAdd"),this.$refs.formAdd.validate(function(t){return t?(e.listObjURL.push(e.objToAdd),e.objToAdd=Object.assign({},c),void(e.listObjURL&&e.$emit("list-changed",e.listObjURL))):(e.$message.error(e.$t("validate.inputCorrect",{label:e.label})),!1)})},eValidate:function(t,e){if(!e)return this.$message.error(this.$t("validate.inputCorrect",{label:this.label})),this.$emit("list-changed",!1),!1;this.$emit("list-changed",this.listObjURL)}}},u=a("5d22"),f=Object(u.a)(d,function(){var r=this,t=r.$createElement,o=r._self._c||t;return o("div",[o("el-form",{ref:"formUpdate",attrs:{model:r.listObjURL,"status-icon":"","inline-message":"true","label-width":"40px"},on:{validate:r.eValidate}},r._l(r.listObjURL,function(e,a){return o("el-form-item",{key:e._id,attrs:{prop:"["+a+"].url",rules:{required:!0,type:"url",message:"请输入有效链接",trigger:"blur"},error:r.strErrorUpdate}},[o("el-input",{on:{input:function(t){return r.eChangeURL({index:a,objLink:e})}},model:{value:e.url,callback:function(t){r.$set(e,"url",t)},expression:"domain.url"}},[o("template",{slot:"prepend"},["音乐"===e.type&&e.name?o("span",{staticStyle:{width:"120px"}},[r._v(r._s(e.name))]):o("img",{staticClass:"img-circle",staticStyle:{width:"32px"},attrs:{src:e.icon}})]),o("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:function(t){return t.preventDefault(),r.removeDomain(e)}},slot:"append"})],2)],1)}),1),o("el-form",{ref:"formAdd",attrs:{model:r.objToAdd,"status-icon":"","label-width":"40px"},on:{validate:r.eValidate}},[o("el-form-item",{key:"add",attrs:{"inline-message":"true",prop:r.url,rules:{required:!0,type:"url",message:"请输入有效链接",trigger:"blur"},error:r.strErrorAdd}},[o("el-input",{on:{input:r.eAddURL},model:{value:r.objToAdd.url,callback:function(t){r.$set(r.objToAdd,"url",t)},expression:"objToAdd.url"}},[o("template",{slot:"prepend"},[o("span",{staticStyle:{width:"32px","text-align":"center"}},[r._v("其他")])])],2)],1)],1)],1)},[],!1,null,null,null).exports,o=a("60bb"),g=a.n(o),d=a("5880");function p(e,t){var a,r=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)),r}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach(function(t){Object(r.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}o=Object(d.createNamespacedHelpers)(nameMod),o={props:{groups:Array},data:function(){var r=this;return{nameMod:nameMod,contentState:[{value:"0",label:"退回"},{value:"1",label:"待审核"},{value:"2",label:"审核通过"},{value:"3",label:"审核不通过"}],loading:!1,userLoading:!1,loadingTag:!1,selectSpecialList:[],content:"",simpleComments:"",isflash:!1,config:{initialFrameWidth:null,initialFrameHeight:320},editorConfig:{autoHeightEnabled:!1,initialFrameHeight:240,initialFrameWidth:"100%",serverUrl:"/api/upload/ueditor",UEDITOR_HOME_URL:this.$root.staticRootPath+"/plugins/ueditor/"},imageUrl:"",currentType:"1",rules:{sImg:[{required:!0,message:this.$t("validate.selectNull",{label:"缩略图"}),trigger:"blur"}],name:[{required:!0,message:this.$t("validate.inputNull",{label:this.$t("contents.name")}),trigger:"blur"},{min:1,max:50,message:this.$t("validate.rangelength",{min:1,max:50}),trigger:"blur"}],tags:[{validator:function(t,e,a){g.a.isEmpty(e)?a(new Error(r.$t("validate.selectNull",{label:r.$t("contents.tags")}))):a()},trigger:"change"}],discription:[{required:!0,message:this.$t("validate.inputNull",{label:this.$t("contents.discription")}),trigger:"blur"},{min:5,max:300,message:this.$t("validate.rangelength",{min:5,max:100}),trigger:"blur"}],comments:[{required:!0,message:this.$t("validate.inputNull",{label:this.$t("contents.comments")}),trigger:"blur"},{min:5,message:this.$t("validate.rangelength",{min:5,max:1e5}),trigger:"blur"}]}}},components:{VueUeditorWrap:s.a,ListURL:f},methods:h(h({},o.mapActions(["showContentForm"])),{},{eChangeFormats:function(t){var s=this;this.formState.formData.listFormatTags.forEach(function(e,a,t){var r,o;e?!!(r=s.formatTagList.docs.find(function(t){return t._id==e}))?(e&&""!=e&&s.formState.formData.tags.push(e),s.formState.formData.tags=Object(i.a)(new Set(s.formState.formData.tags)),s.updateKeywords(r.name)):(s.loadingTag=!0,o={name:e,comments:"发行介质",alias:e},Object(m.a)(o).then(function(t){200===t.status?(s.$store.dispatch("contentTag/getContentTagList"),s.$store.dispatch("contentTag/getFormatTagList"),s.$message({message:s.$t("main.addSuccess"),type:"success"}),s.formState.formData.listFormatTags[a]=t.data._id,s.formState.formData.tags.push(t.data._id),s.updateKeywords(e)):s.$message.error("添加标签错误："+t.message,o),s.loadingTag=!1}).catch(function(t){s.$message.error("添加标签错误："+t,o);debugger})):s.$message.error("标签undefined：",e)})},eChangeArtist:function(t){var s=this;this.formState.formData.listArtists.forEach(function(e,t,a){var r=s.dataArtists.docs.find(function(t){return t._id==e}),o=!!r;o&&s.updateKeywords(r.name)})},eChangeTags:function(t){var s=this;this.formState.formData.tags.forEach(function(e,a,t){var r,o;e?!!(r=s.contentTagList.docs.find(function(t){return t._id==e}))?s.updateKeywords(r.name):(s.loadingTag=!0,o={name:e,comments:"即时创建",alias:e},Object(m.a)(o).then(function(t){200===t.status?(s.$store.dispatch("contentTag/getContentTagList"),s.$message({message:s.$t("main.addSuccess"),type:"success"}),s.formState.formData.tags[a]=t.data._id,s.updateKeywords(e)):s.$message.error("添加标签错误："+t.message,o),s.loadingTag=!1}).catch(function(t){s.$message.error("添加标签错误："+t,o);debugger})):s.$message.error("标签undefined：",e)})},remoteUserMethod:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";""!==t?(this.userLoading=!0,this.queryUserListByParams({searchkey:t,pageSize:200})):this.queryUserListByParams({pageSize:200})},queryUserListByParams:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Object.assign(t,{pageSize:200,files:"name _id sImg"}),this.$store.dispatch(this.nameMod+"/getArtistsList",t),this.userLoading=!1},getRandomContentImg:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Object(l.c)(t).then(function(t){200==t.status&&t&&t.data&&(t=t.data[0],t=Object.assign({},e.formState.formData,{sImg:t}),e.showContentForm({formData:t}))}).catch(function(t){})},checkFlashPost:function(t){this.showContentForm({edit:this.formState.edit,formData:Object.assign({},this.formState.formData,{type:t?"2":"1"})})},inputEditor:function(t){this.showContentForm({edit:this.formState.edit,formData:Object.assign({},this.formState.formData,{markDownComments:t})})},changeEditor:function(t){},getLocalContents:function(){var t=localStorage.getItem("addContent")||"";return t?JSON.parse(t):{}},editorReady:function(t){this.ueditorObj=t},handleAvatarSuccess:function(t,e){t=t.data.path;this.showContentForm({edit:this.formState.edit,formData:Object.assign({},this.formState.formData,{sImg:t})})},beforeAvatarUpload:function(t){var e="image/jpeg"===t.type,a="image/png"===t.type,r="image/gif"===t.type,t=t.size/1024/1024<2;return e||a||r||this.$message.error(this.$t("validate.limitUploadImgType")),t||this.$message.error(this.$t("validate.limitUploadImgSize",{size:2})),(e||a||r)&&t},backToList:function(){this.$router.push(this.$root.adminBasePath+"/"+this.nameMod)},eListHotMusicChanged:function(t){if(!t)return this.isValidate=!1,void this.$message.error(this.$t("validate.inputCorrect",{label:"热门歌曲链接"}));this.formState.formData.listHotMusics=t},eListLinks:function(t){if(!t)return this.isValidate=!1,void this.$message.error(this.$t("validate.inputCorrect",{label:"其他链接"}));this.formState.formData.listLinks=t},eChangeDate:function(t){},updateKeywords:function(t){var e=this.formState.formData.keywords.split(",");return t&&""!=t&&e.push(t),e=Object(i.a)(new Set(e)),this.formState.formData.keywords=e.join(),this.formState.formData.keywords},submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;t=Object.assign({},e.formState.formData,{comments:e.ueditorObj.getContent(),simpleComments:e.ueditorObj.getPlainTxt()});e.formState.edit?Object(l.g)(t,e.nameMod).then(function(t){200===t.status?(e.backToList(),e.$message({message:e.$t("main.updateSuccess"),type:"success"})):e.$message.error(t.message)}).catch(function(t){debugger;e.$message.error(JSON.stringify(t))}):Object(l.a)(t,e.nameMod).then(function(t){200===t.status?(e.backToList(),e.$message({message:e.$t("main.addSuccess"),type:"success"})):e.$message.error(t.message)}).catch(function(t){e.$message.error(t.message)})})}}),computed:h(h({},Object(d.mapGetters)(["contentTagList","contentCategoryList","formatTagList"])),o.mapState({formState:function(t){return t.formState},dataArtists:function(t){return t.dataArtists}})),mounted:function(){var s=this;Object(n.a)(this);var e,a=this;this.$route.params.id?Object(l.b)({id:this.$route.params.id},this.nameMod).then(function(t){var e,a,r,o;200===t.status?t.data?(e=t.data,a=[],r=[],e.categories&&(e.categories.map(function(t,e){t&&a.push(t._id)}),e.categories=a),e.tags&&(e.tags.map(function(t,e){t&&r.push(t._id)}),e.tags=r),e.keywords&&(e.keywords=e.keywords.join()),e.listArtists&&(o=e.listArtists.map(function(t){return t._id}),e.listArtists=o),e.listFormatTags&&(e.listFormatTags=e.listFormatTags.map(function(t,e){return t&&t._id})),s.showContentForm({edit:!0,formData:e})):s.$message({message:s.$t("validate.error_params"),type:"warning",onClose:function(){s.backToList()}}):s.$message.error(t.message)}).catch(function(t){debugger}):(e=this.getLocalContents(),g.a.isEmpty(e)?this.getRandomContentImg():this.$confirm(this.$t("main.askForReInputContent"),this.$t("main.scr_modal_title"),{confirmButtonText:this.$t("main.confirmBtnText"),cancelButtonText:this.$t("main.cancelBtnText"),type:"warning"}).then(function(){var t=e.comments||"";a.$refs.ueditor.setContent(t),localStorage.removeItem(s.$route.path.split("/")[1]),s.showContentForm({edit:!1,formData:e})}).catch(function(){localStorage.removeItem(s.$route.path.split("/")[1]),s.$message({type:"info",message:s.$t("main.scr_modal_del_error_info")})})),this.$store.dispatch("contentCategory/getContentCategoryList"),this.$store.dispatch("contentTag/getContentTagList",{pageSize:200}),this.$store.dispatch("contentTag/getFormatTagList",{pageSize:200}),this.queryUserListByParams()}},a("1179"),o=Object(u.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dr-contentForm",class:e.classObj},[a("div",{staticClass:"main-container"},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.formState.formData,rules:e.rules,"label-width":"120px","label-position":"mobile"==e.device?"top":"right"}},[a("el-form-item",{attrs:{label:e.$t("contents.enable"),prop:"state"}},[a("el-select",{attrs:{size:"small",placeholder:"审核文章"},model:{value:e.formState.formData.state,callback:function(t){e.$set(e.formState.formData,"state",t)},expression:"formState.formData.state"}},e._l(e.contentState,function(t){return a("el-option",{key:"kw_"+t.value,attrs:{label:t.label,value:t.value}})}),1)],1),"3"==e.formState.formData.state?a("el-form-item",{attrs:{label:"驳回原因",prop:"dismissReason"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.dismissReason,callback:function(t){e.$set(e.formState.formData,"dismissReason",t)},expression:"formState.formData.dismissReason"}})],1):e._e(),a("el-form-item",{attrs:{label:e.$t(e.nameMod+".name"),prop:"name"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.name,callback:function(t){e.$set(e.formState.formData,"name",t)},expression:"formState.formData.name"}})],1),a("el-form-item",{attrs:{label:e.$t(e.nameMod+".nameAlias"),prop:"alias"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.alias,callback:function(t){e.$set(e.formState.formData,"alias",t)},expression:"formState.formData.alias"}})],1),a("el-form-item",{attrs:{label:e.$t(e.nameMod+".format"),prop:"listFormatTags"}},[a("el-select",{attrs:{size:"medium",multiple:"",filterable:"","allow-create":"",loading:e.userLoading,placeholder:e.$t("validate.selectNull",{label:this.$t("contents.tags")})},on:{change:e.eChangeFormats},model:{value:e.formState.formData.listFormatTags,callback:function(t){e.$set(e.formState.formData,"listFormatTags",t)},expression:"formState.formData.listFormatTags"}},e._l(e.formatTagList.docs,function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})}),1)],1),a("el-form-item",{attrs:{label:e.$t(e.nameMod+".dateRelease"),prop:"dateRelease"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"发行日期"},on:{change:e.eChangeDate},model:{value:e.formState.formData.dateRelease,callback:function(t){e.$set(e.formState.formData,"dateRelease",t)},expression:"formState.formData.dateRelease"}})],1),a("el-form-item",{attrs:{label:e.$t(e.nameMod+".catalog"),prop:"catalog"}},[a("el-input",{attrs:{size:"small",placeholder:""},model:{value:e.formState.formData.catalog,callback:function(t){e.$set(e.formState.formData,"catalog",t)},expression:"formState.formData.catalog"}})],1),a("el-form-item",{attrs:{label:e.$t(e.nameMod+".listArtists"),prop:"listArtists"}},[a("el-select",{attrs:{size:"medium",filterable:"",multiple:"",placeholder:"作者","remote-method":e.remoteUserMethod,remote:"",loading:e.userLoading},on:{change:e.eChangeArtist},model:{value:e.formState.formData.listArtists,callback:function(t){e.$set(e.formState.formData,"listArtists",t)},expression:"formState.formData.listArtists"}},e._l(e.dataArtists.docs,function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})}),1)],1),"1"==e.formState.formData.type?a("div",[a("el-form-item",{attrs:{label:"标签",prop:"tags"}},[a("el-select",{attrs:{size:"medium",multiple:"",filterable:"","allow-create":"",loading:e.userLoading,placeholder:e.$t("validate.selectNull",{label:this.$t("contents.tags")})},on:{change:e.eChangeTags},model:{value:e.formState.formData.tags,callback:function(t){e.$set(e.formState.formData,"tags",t)},expression:"formState.formData.tags"}},e._l(e.contentTagList.docs,function(t){return a("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})}),1)],1),a("el-form-item",{attrs:{label:"关键字",prop:"keywords"}},[a("el-input",{attrs:{size:"small"},model:{value:e.formState.formData.keywords,callback:function(t){e.$set(e.formState.formData,"keywords",t)},expression:"formState.formData.keywords"}})],1)],1):e._e(),a("el-form-item",{staticClass:"upSimg",attrs:{label:e.$t("contents.sImg"),prop:"sImg"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"/api/upload/files","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,data:{action:"uploadimage"}}},[e.formState.formData.sImg?a("img",{staticClass:"avatar",attrs:{src:e.formState.formData.sImg}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),a("el-button",{staticClass:"refresh-btn",attrs:{size:"mini",plain:"",round:""},on:{click:function(t){return e.getRandomContentImg()}}},[a("svg-icon",{attrs:{"icon-class":"reload"}})],1)],1),a("el-form-item",{attrs:{label:e.$t("contents.discription"),prop:"discription"}},[a("el-input",{attrs:{size:"small",type:"textarea"},model:{value:e.formState.formData.discription,callback:function(t){e.$set(e.formState.formData,"discription",t)},expression:"formState.formData.discription"}})],1),a("el-form-item",{attrs:{label:e.$t("contents.comments"),prop:"comments"}},[a("vue-ueditor-wrap",{staticClass:"editorForm",attrs:{config:e.editorConfig},on:{ready:e.editorReady},model:{value:e.formState.formData.comments,callback:function(t){e.$set(e.formState.formData,"comments",t)},expression:"formState.formData.comments"}})],1),a("el-form-item",{attrs:{label:e.$t(e.nameMod+".listShopLink"),prop:"listShopLink"}},[a("ListURL",{attrs:{label:"购买链接",listObjURL:e.formState.formData.listShopLink},on:{"list-changed":e.eListHotMusicChanged}})],1),a("el-form-item",{staticClass:"dr-submitContent"},[a("el-button",{attrs:{size:"medium",type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(e._s(e.formState.edit?e.$t("main.form_btnText_update"):e.$t("main.form_btnText_save")))]),a("el-button",{attrs:{size:"medium"},on:{click:e.backToList}},[e._v(e._s(e.$t("main.back")))])],1)],1)],1)])},[],!1,null,null,null),e.default=o.exports},"330f":function(t,e,a){"use strict";a.d(e,"a",function(){return s});var e=a("e04f"),r=a.n(e);function o(t){var e=r.a.get("sidebarStatus");t.sidebarOpened="1"==e,t.sidebar&&(t.sidebar.opened=t.sidebarOpened)}function s(e){var t=e.$root;setTimeout(function(){o(e)},500),t&&t.eventBus&&(t.eventBus.$on("toggleSideBar",function(t){setTimeout(function(){o(e)},500)}),t.eventBus.$on("toggleDevice",function(t){e.device=t}));t=document.body.getBoundingClientRect();e.device=t.width-1<992?"mobile":"desktop"}},"53f5":function(t,e,a){var r=a("04e6");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);(0,a("85cb").default)("42fa9bfc",r,!0,{sourceMap:!1,shadowMode:!1})}}]);